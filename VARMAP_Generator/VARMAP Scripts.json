{"files":[{"id":"a25cc6ae-1973-4fc7-a3a5-7997f9ec9a85","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Europe/Madrid\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}"},{"id":"5ca134d8-e350-41ad-96eb-6d5b70f8e9fb","name":"Functions_AddnewItem","type":"server_js","source":"function Auto_AddNewItem()\n{\n  let ss \u003d SpreadsheetApp.getActiveSpreadsheet();\n  // Acceder al intervalo por su nombre\n  \n  let ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertItem\");\n  \n  if (ranges[\"ok\"])\n  {\n    let values \u003d ranges[\"input\"].getValues();\n    let itemID \u003d values[1][0];\n    let itemName \u003d values[1][1];\n    let itemSprite \u003d values[1][2];\n    let itemSpritePickable \u003d itemSprite.replace(\"SPRITE_\",\"SPRITE_PICKABLE_\");\n    let obtainItemEventName \u003d \"EVENT_\" + itemID + \"_PICKABLE_TAKEN\";\n    let observeItemPhraseName \u003d \"PHRASE_OBSERVE_\" + itemID;\n    let takeItemPhraseName \u003d \"PHRASE_TAKE_\" + itemID;\n    let observeItemConditionName \u003d \"COND_OBSERVE_\" + itemID;\n    let takeItemConditionName \u003d \"COND_TAKE_\" + itemID;\n    let itemPickable \u003d (values[1][3].toString().toLowerCase() \u003d\u003d \"true\")\n    let itemSpawn \u003d (values[1][4].toString().toLowerCase() \u003d\u003d \"true\")\n    let pickerChar \u003d values[1][5];\n    let observeItemPhraseContent \u003d values[1][6];\n    let takeItemPhraseContent \u003d values[1][7]\n    let itemRoom \u003d values[1][8];\n\n  \n\n\n\n    /* Add name */\n    Name_Range_AddName(ranges[\"name\"], itemName, itemName);\n\n    /* Add sprite */\n    Sprites_Range_AddSprite(ranges[\"sprites\"], itemSprite, \"SPRITE_ATLAS_INVALID_01\");\n\n    /* Observation phrase (and action) */\n\n    if(observeItemPhraseContent.length \u003e 0)\n    {\n      Phrase_Range_AddPhrase(ranges[\"phrases\"], observeItemPhraseName, observeItemPhraseContent);\n      observeItemConditionName \u003d Actions_Range_AddAction(ranges[\"action_conds\"], observeItemConditionName, \"INTERACTION_OBSERVE\", pickerChar, observeItemPhraseName);\n    }\n    else\n    {\n      observeItemConditionName \u003d \"\";\n    }\n\n    ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertItem\");\n\n    let itemConditions \u003d observeItemConditionName;\n\n    if(itemPickable)\n    {\n      /* Event obtain */\n      obtainItemEventName \u003d Events_Range_AddEvent(ranges[\"events\"], obtainItemEventName);\n\n      /* If pickable sprite does not already exist, insert new row with name */\n      Sprites_Range_AddSprite(ranges[\"sprites\"], itemSpritePickable, \"SPRITE_ATLAS_INVALID_01\");\n\n      /* Take phrase (and action) */\n      if(takeItemPhraseContent.length \u003e 0)\n      {\n        Phrase_Range_AddPhrase(ranges[\"phrases\"], takeItemPhraseName, takeItemPhraseContent);\n        takeItemConditionName \u003d Actions_Range_AddAction(ranges[\"action_conds\"], takeItemConditionName, \"INTERACTION_TAKE\", pickerChar, takeItemPhraseName);\n\n        if(itemConditions.length \u003e 0)\n        {\n          itemConditions +\u003d \", \" + takeItemConditionName;\n        }\n        else\n        {\n          itemConditions \u003d takeItemConditionName;\n        }\n      }\n\n      ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertItem\");\n    }\n\n    if(itemConditions.length \u003d\u003d 0)\n    {\n      itemConditions \u003d \"COND_OK\";\n    }\n\n    /* Finally, add item */\n    itemID \u003d Items_Range_AddItem(ranges[\"items\"], itemID, itemName, itemSprite, itemSpritePickable, itemPickable, itemConditions);\n\n    if(itemPickable \u0026\u0026 (itemRoom !\u003d \"ROOM_NONE\"))\n    {\n      /* Destroy Unchainer when taking */\n      Unchainers_Range_AddUnchainer_Spawn(ranges[\"unchain_conds\"], \"UNCHAINER_\"+itemID+\"_TAKE_1\", itemID, true, false, obtainItemEventName);\n\n      ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertItem\");\n\n      /* Obtain intem officially */\n      Unchainers_Range_AddUnchainer_ObtainItem(ranges[\"unchain_conds\"], \"UNCHAINER_\"+itemID+\"_TAKE_2\", itemID, obtainItemEventName, pickerChar)\n\n      ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertItem\");\n    }\n\n    if(itemSpawn)\n    {\n      Unchainers_Range_AddUnchainer_Spawn(ranges[\"unchain_conds\"], \"UNCHAINER_\"+itemID+\"_DESPAWN\", itemID, false, false, \"EVENT_NONE\");\n      ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertItem\");\n      Unchainers_Range_AddUnchainer_Spawn(ranges[\"unchain_conds\"], \"UNCHAINER_\"+itemID+\"_SPAWN\", itemID, false, true, \"EVENT_NONE\");\n    }\n\n    /* Add it to its room */\n    if(itemRoom !\u003d \"ROOM_NONE\")\n    {\n      Rooms_Range_AddNeededItems(ranges[\"rooms\"], itemRoom, itemID);\n    }\n  } \n  else\n  {\n    Logger.log(\"Some interval does not exist\");\n  }\n}\n\n\n"},{"id":"139b9304-65df-4abd-aa28-4bd2025c77dd","name":"Functions_AddnewRoom","type":"server_js","source":"function Auto_AddNewRoom()\n{\n  let ss \u003d SpreadsheetApp.getActiveSpreadsheet();\n  // Acceder al intervalo por su nombre\n  \n  let ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertRoom\");\n  \n  if (ranges[\"ok\"])\n  {\n    let values \u003d ranges[\"input\"].getValues();\n    let roomID \u003d values[1][0];\n    let backgroundName \u003d values[1][1];\n    let backgroundNightName \u003d values[1][2];\n  \n    Sprites_Range_AddSprite(ranges[\"sprites\"], backgroundName, \"SPRITE_ATLAS_UNDEFINED_01\");\n    ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertRoom\");\n    Sprites_Range_AddSprite(ranges[\"sprites\"], backgroundNightName, \"SPRITE_ATLAS_UNDEFINED_01\");\n    ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertRoom\");\n\n    Rooms_Range_AddRoom(ranges[\"rooms\"], roomID, backgroundName, backgroundNightName);\n  } \n  else\n  {\n    Logger.log(\"Some interval does not exist\");\n  }\n}\n"},{"id":"baff3d3b-0f86-4934-ae4b-e791b1579e83","name":"Functions_AddNewDialog","type":"server_js","source":"function Auto_AddNewDialog()\n{\n  let ss \u003d SpreadsheetApp.getActiveSpreadsheet();\n  // Acceder al intervalo por su nombre\n  \n  let ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertDialog\");\n  \n  if (ranges[\"ok\"])\n  {\n    /** @type {string[]} */\n    let values \u003d ranges[\"input\"].getValues();\n\n    let dialogID \u003d values[1][0];\n    let introPhrases \u003d values[1][1];\n    let talkers \u003d values[1][2];\n\n    /* Add an event to obtain item */\n    let availableDialogs \u003d ranges[\"dialogs\"].getValues().map(fila \u003d\u003e fila[1]);\n    while(availableDialogs.includes(dialogID))\n    {\n      dialogID +\u003d \"_01\";\n    }\n\n    let dialogIntroID \u003d dialogID + \"_INTRO\";\n    while(availableDialogs.includes(dialogIntroID))\n    {\n      dialogIntroID +\u003d \"_01\";\n    }\n\n    /** @type {string[]} */\n    let optionPhrases \u003d [];\n    for(let i \u003d 3; i \u003c 9; i++)\n    {\n      if(values[1][i].length \u003e 0)\n      {\n        optionPhrases.push(values[1][i]);\n      }\n    }\n\n    let createdDialogOptions \u003d \"\";\n\n    /* Create options phrases */\n    for(let i \u003d 0; i \u003c optionPhrases.length; i++)\n    {\n      let subphrases \u003d optionPhrases[i].split(\", \");\n      let createdPhraseIDs \u003d \"\";\n\n      for(let e \u003d 0; e \u003c subphrases.length; e++)\n      {\n        let newPhraseID \u003d Phrase_Range_AddPhrase(ranges[\"phrases\"], \"PHRASE_\"+dialogID+\"_OPTION_\"+i.toString()+\"_\"+e.toString(), subphrases[e]);\n        ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertDialog\");\n        if(e \u003e 0)\n        {\n          createdPhraseIDs +\u003d \", \";\n        }\n        createdPhraseIDs +\u003d newPhraseID;\n      }\n\n      let newDialogOptionID \u003d Dialogs_Range_AddDialogOption(ranges[\"dialog_opts\"], dialogID + \"_OPTION_\" + i.toString(), dialogID, false, createdPhraseIDs);\n      ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertDialog\");\n      if(i \u003e 0)\n      {\n        createdDialogOptions +\u003d \", \";\n      }\n      createdDialogOptions +\u003d newDialogOptionID;\n    }\n\n    Dialogs_Range_AddDialog(ranges[\"dialogs\"], dialogID, talkers, createdDialogOptions);\n    ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertDialog\");\n\n\n    if(introPhrases.length \u003d\u003d 0)\n    {\n      /* No intro phrase, direct dialog options */\n    }\n    else if(introPhrases.includes(\", \"))\n    {\n      /* Randomized intro phrases */\n      let introPhrasesArray \u003d introPhrases.split(\", \");\n      let introPhrasesIDs \u003d \"\";\n      for(let i\u003d0; i \u003c introPhrasesArray.length; i++)\n      {\n        let newPhraseID \u003d Phrase_Range_AddPhrase(ranges[\"phrases\"], \"PHRASE_\"+dialogIntroID+\"_\"+i.toString(), introPhrasesArray[i]);\n        ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertDialog\");\n        if(i \u003e 0)\n        {\n          introPhrasesIDs +\u003d \", \";\n        }\n        introPhrasesIDs +\u003d newPhraseID;\n      }\n      let newDialogOptionID \u003d Dialogs_Range_AddDialogOption(ranges[\"dialog_opts\"], dialogID+\"_OPTION_INTRO\", dialogID, true, introPhrasesIDs);\n      ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertDialog\");\n      Dialogs_Range_AddDialog(ranges[\"dialogs\"], dialogIntroID, talkers, newDialogOptionID);\n      ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertDialog\");\n    }\n    else\n    {\n      /* Single intro */\n      let newPhraseID \u003d Phrase_Range_AddPhrase(ranges[\"phrases\"], \"PHRASE_\"+dialogIntroID, introPhrases);\n      let newDialogOptionID \u003d Dialogs_Range_AddDialogOption(ranges[\"dialog_opts\"], dialogID+\"_OPTION_INTRO\", dialogID, false, newPhraseID);\n      ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertDialog\");\n      Dialogs_Range_AddDialog(ranges[\"dialogs\"], dialogIntroID, talkers, newDialogOptionID);\n      ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertDialog\");\n    }\n  \n\n  } \n  else\n  {\n    Logger.log(\"Some interval does not exist\");\n  }\n}\n"},{"id":"a9ac453b-1be6-4ddb-b155-2ec5de2b41ad","name":"Functions_AddNewMemento","type":"server_js","source":"function Auto_AddNewMemento()\n{\n  let ss \u003d SpreadsheetApp.getActiveSpreadsheet();\n  // Acceder al intervalo por su nombre\n  \n  let ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertMemento\");\n  \n  if (ranges[\"ok\"])\n  {\n    /** @type {string[]} */\n    let values \u003d ranges[\"input\"].getValues();\n\n    let mementoParentID \u003d values[1][0];\n    let mementoIconSpriteID \u003d values[1][1];\n    let mementoParentName \u003d values[1][2];\n    let mementosIDs \u003d values[1][3];\n    let mementosPhrases \u003d values[1][4];\n\n    let mementoIDArray \u003d mementosIDs.split(\", \");\n    let mementoPhrasesArray \u003d mementosPhrases.split(\", \");\n\n    if(mementoIDArray.length !\u003d mementoPhrasesArray.length)\n    {\n      Logger.log(\"IDs and phrases for mementos don\u0027t match in length\");\n      return;\n    }\n\n    /* Get parent memento used ID */\n    let availableParentMementos \u003d ranges[\"memento_parent\"].getValues().map(fila \u003d\u003e fila[1]);\n    while(availableParentMementos.includes(mementoParentID))\n    {\n      mementoParentID +\u003d \"_01\";\n    }\n\n    Sprites_Range_AddSprite(ranges[\"sprites\"], mementoIconSpriteID, \"SPRITE_ATLAS_MEMENTOS\");\n    Name_Range_AddName(ranges[\"name\"], \"NAME_\" + mementoParentID, mementoParentName);\n    mementoParentID \u003d Memento_Parent_Range_AddMementoParent(ranges[\"memento_parent\"], mementoParentID, \"NAME_\" + mementoParentID, mementoIconSpriteID);\n\n    ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertMemento\");\n    \n\n    for(let i\u003d0; i \u003c mementoIDArray.length; i++)\n    {\n      let newMementoPhraseID \u003d Phrase_Range_AddPhrase(ranges[\"phrases\"], \"PHRASE_\"+mementoIDArray[i], mementoPhrasesArray[i]);\n      let newMementoID \u003d Memento_Range_AddMemento(ranges[\"memento\"], mementoIDArray[i], mementoParentID, newMementoPhraseID, i\u003d\u003d(mementoIDArray.length-1));\n\n      ranges \u003d GetWorkingIntervals(ss, \"Interval_autoInsertMemento\");\n    }\n  } \n  else\n  {\n    Logger.log(\"Some interval does not exist\");\n  }\n}\n"},{"id":"8b6e88d9-83bb-43ae-ad36-016ff41d8f1e","name":"AuxFunctions","type":"server_js","source":"/**\n * @param {SpreadsheetApp.Spreadsheet} ss - Spreadsheet\n * @param {string} inputRangeName - inputRangeName\n * @returns {SpreadsheetApp.Range[]} Container\n */\nfunction GetWorkingIntervals(ss, inputRangeName)\n{\n  var retVal \u003d {};\n  retVal[\"input\"] \u003d ss.getRangeByName(inputRangeName);\n  retVal[\"items\"] \u003d ss.getRangeByName(\"Interval_Items\");\n  retVal[\"action_conds\"] \u003d ss.getRangeByName(\"Interval_Action_Conditions\");\n  retVal[\"name\"] \u003d ss.getRangeByName(\"Interval_Name\");\n  retVal[\"phrases\"] \u003d ss.getRangeByName(\"Interval_Phrases\");\n  retVal[\"sprites\"] \u003d ss.getRangeByName(\"Interval_sprites\");\n  retVal[\"events\"] \u003d ss.getRangeByName(\"Interval_Events\");\n  retVal[\"rooms\"] \u003d ss.getRangeByName(\"Interval_Rooms\");\n  retVal[\"unchain_conds\"] \u003d ss.getRangeByName(\"Interval_Unchain_Conditions\");\n  retVal[\"memento\"] \u003d ss.getRangeByName(\"Interval_Memento\");\n  retVal[\"memento_parent\"] \u003d ss.getRangeByName(\"Interval_Memento_Parent\");\n  retVal[\"dialogs\"] \u003d ss.getRangeByName(\"Interval_Dialogs\");\n  retVal[\"dialog_opts\"] \u003d ss.getRangeByName(\"Interval_Dialog_Options\");\n\n  retVal[\"ok\"] \u003d (retVal[\"input\"] !\u003d null) \u0026\u0026 (retVal[\"items\"] !\u003d null) \u0026\u0026 (retVal[\"action_conds\"] !\u003d null);\n  retVal[\"ok\"] \u0026\u003d (retVal[\"name\"] !\u003d null) \u0026\u0026 (retVal[\"phrases\"] !\u003d null) \u0026\u0026 (retVal[\"sprites\"] !\u003d null) \u0026\u0026 (retVal[\"events\"] !\u003d null);\n  retVal[\"ok\"] \u0026\u003d (retVal[\"rooms\"] !\u003d null) \u0026\u0026 (retVal[\"unchain_conds\"] !\u003d null) \u0026\u0026 (retVal[\"memento\"] !\u003d null);\n  retVal[\"ok\"] \u0026\u003d (retVal[\"memento_parent\"] !\u003d null) \u0026\u0026 (retVal[\"dialogs\"] !\u003d null) \u0026\u0026 (retVal[\"dialog_opts\"] !\u003d null);\n\n\n  return retVal;\n}\n\n/**\n * @param {SpreadsheetApp.Range} range - range\n * @return {SpreadsheetApp.Range} destRange\n */\nfunction InsertRowBeforeEnd(range)\n{\n  const hoja \u003d range.getSheet();\n  const filaInicio \u003d range.getRow();\n  const numFilas \u003d range.getNumRows();\n  const numColumnas \u003d range.getNumColumns();\n  const columnaInicio \u003d range.getColumn();\n\n  // 2. Calcular posiciones\n  // La última fila del range es: filaInicio + numFilas - 1\n  // La penúltima fila es esa menos 1.\n  const ultimaFilaAbsoluta \u003d filaInicio + numFilas - 1;\n  const penultimaFilaAbsoluta \u003d ultimaFilaAbsoluta - 1;\n\n  // 3. Insertar una fila vacía justo antes de la última\n  // Al insertar en la posición de la \u0027última\u0027, la que era última baja un lugar\n  hoja.insertRowBefore(ultimaFilaAbsoluta);\n\n  // 4. Copiar el contenido de la penúltima a la nueva fila creada\n  // El origen es la penúltima (que no se movió)\n  const origen \u003d hoja.getRange(penultimaFilaAbsoluta, columnaInicio, 1, numColumnas);\n  \n  // El destino es la fila que acabamos de insertar (que ahora ocupa la posición \u0027ultimaFilaAbsoluta\u0027)\n  const destino \u003d hoja.getRange(ultimaFilaAbsoluta, columnaInicio, 1, numColumnas);\n\n  origen.copyTo(destino);\n\n  const destinoWoutIndex \u003d hoja.getRange(ultimaFilaAbsoluta, columnaInicio + 1, 1, numColumnas - 1);\n\n  return destinoWoutIndex;\n}\n\n\n\n"},{"id":"58888ad2-5d6d-4959-b73a-0e115d8991f7","name":"ActionsFunctions","type":"server_js","source":"/**\n * @param {SpreadsheetApp.Range} actionsRange - actionsRange\n * @param {string} actionIDInput - actionIDInput\n * @param {string} interaction_type - interaction_type\n * @param {string} sourceChar - sourceChar\n * @param {string} phraseID - phraseID\n * @returns {string} actionID\n */\nfunction Actions_Range_AddAction(actionsRange, actionIDInput, interaction_type, sourceChar, phraseID)\n{\n  let availableConds \u003d actionsRange.getValues().map(fila \u003d\u003e fila[1]);\n  let actionID \u003d actionIDInput;\n  while(availableConds.includes(actionID))\n  {\n    actionID +\u003d \"_01\";\n  }\n  let newCondRow \u003d InsertRowBeforeEnd(actionsRange);\n  let newCondArray \u003d newCondRow.getValues();\n  newCondArray[0][0] \u003d actionID;\n  newCondArray[0][1] \u003d \"EVENT_NONE\";\n  newCondArray[0][2] \u003d \"MOMENT_ANY\";\n  newCondArray[0][3] \u003d sourceChar;\n  newCondArray[0][4] \u003d \"ITEM_NONE\";\n  newCondArray[0][5] \u003d interaction_type;\n  newCondArray[0][6] \u003d \"ITEM_USE_ANIMATION_NONE\";\n  newCondArray[0][7] \u003d phraseID !\u003d null ? \"DIALOG_SIMPLE\" : \"DIALOG_NONE\";\n  newCondArray[0][8] \u003d phraseID !\u003d null ? phraseID : \"PHRASE_NONE\";\n  newCondArray[0][9] \u003d \"EVENT_NONE\";\n\n  newCondRow.setValues(newCondArray);\n\n  return actionID;\n}"},{"id":"887b9735-8db6-49be-ac82-e84368965d18","name":"PhraseFunctions","type":"server_js","source":"/**\n * @param {SpreadsheetApp.Range} phrasesRange - phrasesRange\n * @param {string} phraseIDInput - phraseIDInput\n * @param {string} phraseContent - phraseContent\n * @returns {string} phraseID\n */\nfunction Phrase_Range_AddPhrase(phrasesRange, phraseIDInput, phraseContent)\n{\n  let phraseID \u003d phraseIDInput;\n  let availablePhrases \u003d phrasesRange.getValues().map(fila \u003d\u003e fila[1]);\n  while(availablePhrases.includes(phraseID))\n  {\n    phraseID +\u003d \"_01\";\n  }\n  let newPhraseRow \u003d InsertRowBeforeEnd(phrasesRange);\n  let newPhraseArray \u003d newPhraseRow.getValues();\n  newPhraseArray[0][0] \u003d phraseID;\n  newPhraseArray[0][1] \u003d 0;\n  newPhraseArray[0][2] \u003d 0;\n  newPhraseArray[0][3] \u003d \"DIALOG_ANIMATION_TALK\";\n\n  for(let i\u003d4; i \u003c newPhraseArray[0].length; i++)\n  {\n    newPhraseArray[0][i] \u003d phraseContent;\n  }\n  newPhraseRow.setValues(newPhraseArray);\n\n  return phraseID;\n}\n"},{"id":"8e0c21b3-4709-413f-a9a3-91893741f870","name":"NameFunctions","type":"server_js","source":"/**\n * @param {SpreadsheetApp.Range} nameRange - nameRange\n * @param {string} nameIDInput - nameIDInput\n * @param {string} nameContent - nameContent\n */\nfunction Name_Range_AddName(nameRange, nameIDInput, nameContent)\n{\n  /* If name does not already exist, insert new row with name */\n  let availableNames \u003d nameRange.getValues().map(fila \u003d\u003e fila[1]);\n  if(!availableNames.includes(nameIDInput))\n  {\n    let newNameRow \u003d InsertRowBeforeEnd(nameRange);\n    let languageNames \u003d newNameRow.getValues();\n    \n    languageNames[0][0] \u003d nameIDInput;\n    for(let i \u003d 1; i \u003c languageNames[0].length; i++)\n    {\n      languageNames[0][i] \u003d nameContent;\n    }\n    newNameRow.setValues(languageNames);\n  }\n}\n"},{"id":"5c66acf0-7d04-4a5f-a5dc-2eb3ad0dd87a","name":"SpritesFunctions","type":"server_js","source":"/**\n * @param {SpreadsheetApp.Range} spritesRange - spritesRange\n * @param {string} spriteIDInput - spriteIDInput\n * @param {string} spriteAtlas - spriteAtlas\n */\nfunction Sprites_Range_AddSprite(spritesRange, spriteIDInput, spriteAtlas)\n{\n  /* If sprite does not already exist, insert new row with name */\n    let availableSprites \u003d spritesRange.getValues().map(fila \u003d\u003e fila[1]);\n    if(!availableSprites.includes(spriteIDInput))\n    {\n      let newSpriteRow \u003d InsertRowBeforeEnd(spritesRange);\n      let newSpriteArray \u003d newSpriteRow.getValues();\n      newSpriteArray[0][0] \u003d spriteIDInput;\n      newSpriteArray[0][1] \u003d spriteAtlas + \"[\" + spriteIDInput + \"]\";\n      newSpriteRow.setValues(newSpriteArray);\n    }\n}\n"},{"id":"cae51ac3-44c0-4ac9-900e-9ff47f873dc7","name":"EventsFunctions","type":"server_js","source":"/**\n * @param {SpreadsheetApp.Range} eventsRange - eventsRange\n * @param {string} eventIDInput - eventIDInput\n * @returns {string} eventID\n */\nfunction Events_Range_AddEvent(eventsRange, eventIDInput)\n{\n  let eventID \u003d eventIDInput;\n\n  /* Add an event to obtain item */\n  let availableEvents \u003d eventsRange.getValues().map(fila \u003d\u003e fila[1]);\n  while(availableEvents.includes(eventID))\n  {\n    eventID +\u003d \"_01\";\n  }\n\n  let newEventRow \u003d InsertRowBeforeEnd(eventsRange);\n  let newEventArray \u003d newEventRow.getValues();\n  newEventArray[0][0] \u003d eventID;\n  newEventRow.setValues(newEventArray);\n\n  return eventID;\n}\n"},{"id":"e955ddf6-d3af-45c5-894d-5131d4a1f8e0","name":"ItemsFunctions","type":"server_js","source":"/**\n * @param {SpreadsheetApp.Range} itemsRange - itemsRange\n * @param {string} itemIDInput - itemIDInput\n * @param {string} nameID - nameID\n * @param {string} spriteID - spriteID\n * @param {string} spriteIDPickable - spriteIDPickable\n * @param {boolean} pickable - pickable\n * @param {string} conditions - conditions\n * @returns {string} itemID\n */\nfunction Items_Range_AddItem(itemsRange, itemIDInput, nameID, spriteID, spriteIDPickable, pickable, conditions)\n{\n  let itemID \u003d itemIDInput;\n\n  /* Add an event to obtain item */\n  let availableItems \u003d itemsRange.getValues().map(fila \u003d\u003e fila[1]);\n  while(availableItems.includes(itemID))\n  {\n    itemID +\u003d \"_01\";\n  }\n\n  /* Copy content of last but one to the new last but one (Insert a copy) */\n  let newItemRange \u003d InsertRowBeforeEnd(itemsRange);\n\n  /* Give format to new item */\n  let newItemArray \u003d newItemRange.getValues();\n  newItemArray[0][0] \u003d itemID;\n  newItemArray[0][1] \u003d nameID;\n  newItemArray[0][2] \u003d \"ITEM_FAMILY_TYPE_OBJECT\";\n  newItemArray[0][3] \u003d spriteID;\n  newItemArray[0][4] \u003d spriteID;\n  newItemArray[0][5] \u003d pickable ? \"TRUE\" : \"FALSE\";\n  newItemArray[0][6] \u003d pickable ? spriteIDPickable : \"SPRITE_NONE\";\n  newItemArray[0][7] \u003d \"DETAIL_NONE\";\n  newItemArray[0][8] \u003d conditions;\n\n  newItemRange.setValues(newItemArray);\n\n  return itemID;\n}\n"},{"id":"697bca14-7741-41c8-ac37-85b2018d0e2a","name":"RoomsFunctions","type":"server_js","source":"/**\n * @param {SpreadsheetApp.Range} roomsRange - roomsRange\n * @param {string} roomID - roomID\n * @param {string} itemID - itemID\n */\nfunction Rooms_Range_AddNeededItems(roomsRange, roomID, itemID)\n{\n  /* Add to desired room (If exists) */\n  let roomsArray \u003d roomsRange.getValues();\n  let roomsSheet \u003d roomsRange.getSheet();\n\n  for(let i\u003d1; i \u003c roomsArray.length; i++)\n  {\n    if(roomsArray[i][1] \u003d\u003d roomID)\n    {\n      let neededItemsRange \u003d roomsSheet.getRange(roomsRange.getRow()+i, 6, 1, 1);\n      let neededItemsArray \u003d neededItemsRange.getValues();\n      neededItemsArray[0][0] +\u003d \", \" + itemID;\n      neededItemsRange.setValues(neededItemsArray);\n    }\n  }\n}\n\n/**\n * @param {SpreadsheetApp.Range} roomsRange - roomsRange\n * @param {string} roomIDInput - roomIDInput\n * @param {string} bakcgroundID - bakcgroundID\n * @param {string} bakcgroundNightID - bakcgroundNightID\n * @returns {string} roomID\n */\nfunction Rooms_Range_AddRoom(roomsRange, roomIDInput, bakcgroundID, bakcgroundNightID)\n{\n  let roomID \u003d roomIDInput;\n\n  /* Add an event to obtain item */\n  let availableRooms \u003d roomsRange.getValues().map(fila \u003d\u003e fila[1]);\n  while(availableRooms.includes(roomID))\n  {\n    roomID +\u003d \"_01\";\n  }\n\n  let needed_bckgs \u003d bakcgroundID + \", \" + bakcgroundNightID;\n\n  let newRoomRow \u003d InsertRowBeforeEnd(roomsRange);\n  let hoja \u003d roomsRange.getSheet();\n\n  /* Room rows have formulas, it is important to use value ranges which not involve formulas */\n  let edit_range \u003d hoja.getRange(newRoomRow.getRow(), 2, 1, 9);\n  let edit_array \u003d edit_range.getValues();\n\n  edit_array[0][0] \u003d roomID;\n  edit_array[0][1] \u003d needed_bckgs;\n  edit_array[0][2] \u003d \"SOUND_NONE\";\n  edit_array[0][3] \u003d needed_bckgs;\n  edit_array[0][4] \u003d \"ITEM_GENERIC_DOOR1\";\n  edit_array[0][5] \u003d \"NAME_NONE\";\n  edit_array[0][6] \u003d \"SOUND_NONE\";\n  edit_array[0][7] \u003d \"COND_OK\";\n  edit_array[0][8] \u003d \"PHRASE_NONSENSE\";\n\n  edit_range.setValues(edit_array);\n\n  return roomID;\n}\n"},{"id":"344d7cab-6960-4810-8073-4ee691222b06","name":"UnchainerFunctions","type":"server_js","source":"/**\n * @param {SpreadsheetApp.Range} unchainersRange - unchainersRange\n * @param {string} unchainerIDInput - unchainerIDInput\n * @param {string} itemID - itemID\n * @param {boolean} destroy - destroy\n * @param {boolean} spawn - spawn\n * @param {string} neededEventID - neededEventID\n * @returns {string} unchainerID \n */\nfunction Unchainers_Range_AddUnchainer_Spawn(unchainersRange, unchainerIDInput, itemID, destroy, spawn, neededEventID)\n{\n  let retVal \u003d _Unchainers_Range_AddUnchainer_Internal(unchainersRange, unchainerIDInput);\n  let newUnchainerRange \u003d retVal[0];\n  let unchainerID \u003d retVal[1];\n\n  let newUnchainerArray \u003d newUnchainerRange.getValues();\n  newUnchainerArray[0][1] \u003d destroy ? \"FALSE\" : \"TRUE\";\n  newUnchainerArray[0][2] \u003d destroy ? \"UNCHAIN_TYPE_DESTROY\" : (spawn ? \"UNCHAIN_TYPE_SPAWN\" : \"UNCHAIN_TYPE_DESPAWN\");\n  newUnchainerArray[0][4] \u003d neededEventID;\n  newUnchainerArray[0][6] \u003d itemID;\n  newUnchainerRange.setValues(newUnchainerArray);\n\n  return unchainerID;\n}\n\n/**\n * @param {SpreadsheetApp.Range} unchainersRange - unchainersRange\n * @param {string} unchainerIDInput - unchainerIDInput\n * @param {string} itemID - itemID\n * @param {string} neededEventID - neededEventID\n * @param {string} pickerChar - pickerChar\n * @returns {string} unchainerID \n */\nfunction Unchainers_Range_AddUnchainer_ObtainItem(unchainersRange, unchainerIDInput, itemID, neededEventID, pickerChar)\n{\n  let retVal \u003d _Unchainers_Range_AddUnchainer_Internal(unchainersRange, unchainerIDInput);\n  let newUnchainerRange \u003d retVal[0];\n  let unchainerID \u003d retVal[1];\n\n  let newUnchainerArray \u003d newUnchainerRange.getValues();\n  newUnchainerArray[0][2] \u003d \"UNCHAIN_TYPE_EARN_ITEM\";\n  newUnchainerArray[0][3] \u003d neededEventID;\n  newUnchainerArray[0][4] \u003d neededEventID;\n  newUnchainerArray[0][6] \u003d itemID;\n  newUnchainerArray[0][8] \u003d pickerChar;\n  newUnchainerRange.setValues(newUnchainerArray);\n\n  return unchainerID;\n}\n\n/**\n * @param {SpreadsheetApp.Range} unchainersRange - unchainersRange\n * @param {string} unchainerIDInput - unchainerIDInput\n * @returns {[SpreadsheetApp.Range, string]} Tuple with inserted range and used unchainerID.\n */\nfunction _Unchainers_Range_AddUnchainer_Internal(unchainersRange, unchainerIDInput)\n{\n  let unchainerID \u003d unchainerIDInput;\n\n  /* Add an event to obtain item */\n  let availableUnchainers \u003d unchainersRange.getValues().map(fila \u003d\u003e fila[1]);\n  while(availableUnchainers.includes(unchainerID))\n  {\n    unchainerID +\u003d \"_01\";\n  }\n\n  /* Copy content of last but one to the new last but one (Insert a copy) */\n  let newUnchainerRange \u003d InsertRowBeforeEnd(unchainersRange);\n  let newUnchainerArray \u003d newUnchainerRange.getValues();\n  newUnchainerArray[0][0] \u003d unchainerID;\n  newUnchainerArray[0][1] \u003d \"FALSE\";\n  newUnchainerArray[0][2] \u003d \"UNCHAIN_TYPE_EVENT\";\n  newUnchainerArray[0][3] \u003d \"EVENT_NONE\";\n  newUnchainerArray[0][4] \u003d \"EVENT_NONE\";\n  newUnchainerArray[0][5] \u003d \"MOMENT_ANY\";\n  newUnchainerArray[0][6] \u003d \"ITEM_NONE\";\n  newUnchainerArray[0][7] \u003d \"SPRITE_NONE\";\n  newUnchainerArray[0][8] \u003d \"CHARACTER_NONE\";\n  newUnchainerArray[0][9] \u003d \"MEMENTO_NONE\";\n  newUnchainerArray[0][10] \u003d \"EVENT_NONE\";\n  newUnchainerArray[0][11] \u003d \"DECISION_NONE\";\n  newUnchainerArray[0][12] \u003d \"MOMENT_ANY\";\n  newUnchainerRange.setValues(newUnchainerArray);\n\n  let retVal \u003d [newUnchainerRange, unchainerID];\n\n  return retVal;\n}"},{"id":"5493ee72-f4d0-4570-bd3c-e8241d9b653d","name":"DialogFunctions","type":"server_js","source":"/**\n * @param {SpreadsheetApp.Range} dialogsRange - dialogsRange\n * @param {string} dialogIDInput - dialogIDInput\n * @param {string} talkerItemsID - talkerItemsID\n * @param {string} options - options\n * @returns {string} dialogID\n */\nfunction Dialogs_Range_AddDialog(dialogsRange, dialogIDInput, talkerItemsID, options)\n{\n  let dialogID \u003d dialogIDInput;\n\n  /* Add an event to obtain item */\n  let availableDialogs \u003d dialogsRange.getValues().map(fila \u003d\u003e fila[1]);\n  while(availableDialogs.includes(dialogID))\n  {\n    dialogID +\u003d \"_01\";\n  }\n\n  let newDialogRow \u003d InsertRowBeforeEnd(dialogsRange);\n  let newDialogArray \u003d newDialogRow.getValues();\n  newDialogArray[0][0] \u003d dialogID;\n  newDialogArray[0][1] \u003d talkerItemsID;\n  newDialogArray[0][2] \u003d options;\n\n  newDialogRow.setValues(newDialogArray);\n\n  return dialogID;\n}\n\n\n/**\n * @param {SpreadsheetApp.Range} dialogOptsRange - dialogOptsRange\n * @param {string} dialogOptionIDInput - dialogOptionIDInput\n * @param {string} triggeredDialogID - triggeredDialogID\n * @param {boolean} randomized - randomized\n * @param {string} phrasesIDs - phrasesIDs\n * @returns {string} dialogOptionID\n */\nfunction Dialogs_Range_AddDialogOption(dialogOptsRange, dialogOptionIDInput, triggeredDialogID, randomized, phrasesIDs)\n{\n  let dialogOptionID \u003d dialogOptionIDInput;\n\n  /* Add an event to obtain item */\n  let availableDialogs \u003d dialogOptsRange.getValues().map(fila \u003d\u003e fila[1]);\n  while(availableDialogs.includes(dialogOptionID))\n  {\n    dialogOptionID +\u003d \"_01\";\n  }\n\n  let newDialogRow \u003d InsertRowBeforeEnd(dialogOptsRange);\n  let newDialogArray \u003d newDialogRow.getValues();\n  newDialogArray[0][0] \u003d dialogOptionID;\n  newDialogArray[0][1] \u003d \"EVENT_NONE\";\n  newDialogArray[0][2] \u003d \"MOMENT_ANY\";\n  newDialogArray[0][3] \u003d \"EVENT_NONE\";\n  newDialogArray[0][4] \u003d triggeredDialogID;\n  newDialogArray[0][5] \u003d randomized ? \"TRUE\" : \"FALSE\";\n  newDialogArray[0][6] \u003d phrasesIDs;\n\n  newDialogRow.setValues(newDialogArray);\n\n  return dialogOptionID;\n}"},{"id":"8b7d4578-be57-4280-b22e-fc95ca98f331","name":"MementoFunctions","type":"server_js","source":"/**\n * @param {SpreadsheetApp.Range} mementoRange - mementoRange\n * @param {string} mementoIDInput - mementoIDInput\n * @param {string} mementoParentID - mementoParentID\n * @param {string} mementoPhraseID - mementoPhraseID\n * @param {boolean} final - final\n * @returns {string} mementoID\n */\nfunction Memento_Range_AddMemento(mementoRange, mementoIDInput, mementoParentID, mementoPhraseID, final)\n{\n  let mementoID \u003d mementoIDInput;\n\n  /* Add an event to obtain item */\n  let availableMementos \u003d mementoRange.getValues().map(fila \u003d\u003e fila[1]);\n  while(availableMementos.includes(mementoID))\n  {\n    mementoID +\u003d \"_01\";\n  }\n\n  let newMementoRow \u003d InsertRowBeforeEnd(mementoRange);\n  let newMementoArray \u003d newMementoRow.getValues();\n  newMementoArray[0][0] \u003d mementoID;\n  newMementoArray[0][1] \u003d mementoParentID;\n  newMementoArray[0][2] \u003d mementoPhraseID;\n  newMementoArray[0][3] \u003d \"MEMENTO_COMBI_NONE\"\n  newMementoArray[0][4] \u003d final ? \"TRUE\" : \"FALSE\";\n  newMementoRow.setValues(newMementoArray);\n\n  return mementoID;\n}\n\n/**\n * @param {SpreadsheetApp.Range} mementoRange - mementoRange\n * @param {string} mementoIDInput - mementoIDInput\n * @param {string} mementoNameID - mementoNameID\n * @param {string} mementoSpriteID - mementoSpriteID\n * @returns {string} mementoID\n */\nfunction Memento_Parent_Range_AddMementoParent(mementoParentRange, mementoIDInput, mementoNameID, mementoSpriteID)\n{\n  let mementoID \u003d mementoIDInput;\n\n  /* Add an event to obtain item */\n  let availableMementos \u003d mementoParentRange.getValues().map(fila \u003d\u003e fila[1]);\n  while(availableMementos.includes(mementoID))\n  {\n    mementoID +\u003d \"_01\";\n  }\n\n  let newMementoRow \u003d InsertRowBeforeEnd(mementoParentRange);\n  let hoja \u003d mementoParentRange.getSheet();\n\n  /* Room rows have formulas, it is important to use value ranges which not involve formulas */\n  let edit_range \u003d hoja.getRange(newMementoRow.getRow(), 2, 1, 3);\n  let edit_array \u003d edit_range.getValues();\n\n  edit_array[0][0] \u003d mementoID;\n  edit_array[0][1] \u003d mementoNameID;\n  edit_array[0][2] \u003d mementoSpriteID;\n  edit_range.setValues(edit_array);\n\n  return mementoID;\n}\n"},{"id":"325bf7bb-4782-430b-921e-a22f5dd4702c","name":"Functions_AddBlankUnchainer","type":"server_js","source":"function Unchainer_AddNewBlankUnchainer()\n{\n  let ss \u003d SpreadsheetApp.getActiveSpreadsheet();\n  let ranges \u003d GetWorkingIntervals(ss, \"Interval_Unchain_Conditions\");\n  \n  if (ranges[\"ok\"])\n  {\n    _Unchainers_Range_AddUnchainer_Internal(ranges[\"unchain_conds\"], \"UNCHAIN_NEW_ONE\");\n  }\n}\n"}]}